<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>0649-deprecation-staging - </title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="affix"><a href="introduction.html">Introduction</a></li><li><a href="0001-transform-attribute-meta-parameter.html">0001-transform-attribute-meta-parameter</a></li><li><a href="0003-block-params.html">0003-block-params</a></li><li><a href="0003-cli-ember-doctor.html">0003-cli-ember-doctor</a></li><li><a href="0010-engines.html">0010-engines</a></li><li><a href="0011-improved-cp-syntax.html">0011-improved-cp-syntax</a></li><li><a href="0012-help-json-output.html">0012-help-json-output</a></li><li><a href="0015-the-road-to-ember-2-0.html">0015-the-road-to-ember-2-0</a></li><li><a href="0020-sri-default.html">0020-sri-default</a></li><li><a href="0023-command-line-completion.html">0023-command-line-completion</a></li><li><a href="0024-bound-attributes.html">0024-bound-attributes</a></li><li><a href="0028-app-import-output-file.html">0028-app-import-output-file</a></li><li><a href="0029-addon-black-and-whitelist-for-apps.html">0029-addon-black-and-whitelist-for-apps</a></li><li><a href="0045-internet-explorer.html">0045-internet-explorer</a></li><li><a href="0046-cli-improved-release-process.html">0046-cli-improved-release-process</a></li><li><a href="0046-registry-reform.html">0046-registry-reform</a></li><li><a href="0050-cli-production-code-stripping.html">0050-cli-production-code-stripping</a></li><li><a href="0050-improved-actions.html">0050-improved-actions</a></li><li><a href="0053-helpers.html">0053-helpers</a></li><li><a href="0055-anonymous-amd.html">0055-anonymous-amd</a></li><li><a href="0056-improved-release-cycle.html">0056-improved-release-cycle</a></li><li><a href="0057-ember-data-reference-unification.html">0057-ember-data-reference-unification</a></li><li><a href="0058-helper-listing.html">0058-helper-listing</a></li><li><a href="0061-ember-data-background-fetch.html">0061-ember-data-background-fetch</a></li><li><a href="0064-contextual-component-lookup.html">0064-contextual-component-lookup</a></li><li><a href="0065-deprecation-warning-handlers.html">0065-deprecation-warning-handlers</a></li><li><a href="0080-serve-file-api.html">0080-serve-file-api</a></li><li><a href="0086-firefox-in-ci.html">0086-firefox-in-ci</a></li><li><a href="0090-addon-tree-caching.html">0090-addon-tree-caching</a></li><li><a href="0091-cli-addon-instrumentation-experimental-hooks.html">0091-cli-addon-instrumentation-experimental-hooks</a></li><li><a href="0091-weakmap.html">0091-weakmap</a></li><li><a href="0092-blueprint-remove-old-files.html">0092-blueprint-remove-old-files</a></li><li><a href="0095-cli-standardise-targets.html">0095-cli-standardise-targets</a></li><li><a href="0095-router-service.html">0095-router-service</a></li><li><a href="0096-enable-yarn-usage.html">0096-enable-yarn-usage</a></li><li><a href="0101-ember-data-friendly-errors.html">0101-ember-data-friendly-errors</a></li><li><a href="0105-addons-optionalDependencies.html">0105-addons-optionalDependencies</a></li><li><a href="0108-add-custom-transform.html">0108-add-custom-transform</a></li><li><a href="0110-packaging.html">0110-packaging</a></li><li><a href="0114-add-template-lint-addon.html">0114-add-template-lint-addon</a></li><li><a href="0116-qunit-dom.html">0116-qunit-dom</a></li><li><a href="0120-cli-guides.html">0120-cli-guides</a></li><li><a href="0120-route-serializers.html">0120-route-serializers</a></li><li><a href="0121-remove-ember-cli-eslint.html">0121-remove-ember-cli-eslint</a></li><li><a href="0136-contains-to-includes.html">0136-contains-to-includes</a></li><li><a href="0139-isHtmlSafe.html">0139-isHtmlSafe</a></li><li><a href="0143-module-unification.html">0143-module-unification</a></li><li><a href="0150-factory-for.html">0150-factory-for</a></li><li><a href="0176-javascript-module-api.html">0176-javascript-module-api</a></li><li><a href="0178-deprecate-ember-k.html">0178-deprecate-ember-k</a></li><li><a href="0181-deprecate-ember-data-initializers.html">0181-deprecate-ember-data-initializers</a></li><li><a href="0186-track-unique-history-location-state.html">0186-track-unique-history-location-state</a></li><li><a href="0191-deprecate-component-lifecycle-hook-args.html">0191-deprecate-component-lifecycle-hook-args</a></li><li><a href="0194-deprecate-custom-event-manager.html">0194-deprecate-custom-event-manager</a></li><li><a href="0213-custom-components.html">0213-custom-components</a></li><li><a href="0225-ember-engines-mount-params.html">0225-ember-engines-mount-params</a></li><li><a href="0226-named-blocks.html">0226-named-blocks</a></li><li><a href="0229-deprecate-testing-restricted-resolver.html">0229-deprecate-testing-restricted-resolver</a></li><li><a href="0232-simplify-qunit-testing-api.html">0232-simplify-qunit-testing-api</a></li><li><a href="0236-deprecation-ember-string.html">0236-deprecation-ember-string</a></li><li><a href="0237-deprecation-ember-map.html">0237-deprecation-ember-map</a></li><li><a href="0240-es-classes.html">0240-es-classes</a></li><li><a href="0252-browser-support-changes.html">0252-browser-support-changes</a></li><li><a href="0268-acceptance-testing-refactor.html">0268-acceptance-testing-refactor</a></li><li><a href="0272-deprecation-native-function-prototype-extensions.html">0272-deprecation-native-function-prototype-extensions</a></li><li><a href="0276-named-args.html">0276-named-args</a></li><li><a href="0278-template-only-components.html">0278-template-only-components</a></li><li><a href="0280-remove-application-wrapper.html">0280-remove-application-wrapper</a></li><li><a href="0281-es5-getters.html">0281-es5-getters</a></li><li><a href="0286-block-let-template-helper.html">0286-block-let-template-helper</a></li><li><a href="0287-promote-in-element-to-public-api.html">0287-promote-in-element-to-public-api</a></li><li><a href="0293-record-data.html">0293-record-data</a></li><li><a href="0294-optional-jquery.html">0294-optional-jquery</a></li><li><a href="0297-deprecate-ember-logger.html">0297-deprecate-ember-logger</a></li><li><a href="0300-rfc-process-update.html">0300-rfc-process-update</a></li><li><a href="0308-deprecate-property-lookup-fallback.html">0308-deprecate-property-lookup-fallback</a></li><li><a href="0311-angle-bracket-invocation.html">0311-angle-bracket-invocation</a></li><li><a href="0318-array-helper.html">0318-array-helper</a></li><li><a href="0322-deprecate-copy-copyable.html">0322-deprecate-copy-copyable</a></li><li><a href="0324-deprecate-component-isvisible.html">0324-deprecate-component-isvisible</a></li><li><a href="0326-ember-data-filter-deprecation.html">0326-ember-data-filter-deprecation</a></li><li><a href="0329-deprecated-ember-evented-in-ember-data.html">0329-deprecated-ember-evented-in-ember-data</a></li><li><a href="0331-deprecate-globals-resolver.html">0331-deprecate-globals-resolver</a></li><li><a href="0332-ember-data-record-links-and-meta.html">0332-ember-data-record-links-and-meta</a></li><li><a href="0335-deprecate-send-action.html">0335-deprecate-send-action</a></li><li><a href="0337-native-class-constructor-update.html">0337-native-class-constructor-update</a></li><li><a href="0340-deprecate-ember-merge.html">0340-deprecate-ember-merge</a></li><li><a href="0345-discord.html">0345-discord</a></li><li><a href="0364-roadmap-2018.html">0364-roadmap-2018</a></li><li><a href="0369-deprecate-computed-clobberability.html">0369-deprecate-computed-clobberability</a></li><li><a href="0370-deprecate-computed-volatile.html">0370-deprecate-computed-volatile</a></li><li><a href="0372-ember-data-model-factory-for.html">0372-ember-data-model-factory-for</a></li><li><a href="0373-Element-Modifier-Managers.html">0373-Element-Modifier-Managers</a></li><li><a href="0375-deprecate-computed-property-modifier.html">0375-deprecate-computed-property-modifier</a></li><li><a href="0386-remove-jquery.html">0386-remove-jquery</a></li><li><a href="0389-dynamic-tag-names.html">0389-dynamic-tag-names</a></li><li><a href="0391-router-helpers.html">0391-router-helpers</a></li><li><a href="0392-deprecate-component-manager-string-lookup.html">0392-deprecate-component-manager-string-lookup</a></li><li><a href="0395-ember-data-packages.html">0395-ember-data-packages</a></li><li><a href="0398-RouteInfo-Metadata.html">0398-RouteInfo-Metadata</a></li><li><a href="0403-ember-data-identifiers.html">0403-ember-data-identifiers</a></li><li><a href="0408-decorators.html">0408-decorators</a></li><li><a href="0410-tracked-properties.html">0410-tracked-properties</a></li><li><a href="0415-render-element-modifiers.html">0415-render-element-modifiers</a></li><li><a href="0416-glimmer-components.html">0416-glimmer-components</a></li><li><a href="0418-deprecate-route-render-methods.html">0418-deprecate-route-render-methods</a></li><li><a href="0421-deprecate-application-controller-props.html">0421-deprecate-application-controller-props</a></li><li><a href="0425-website-redesign.html">0425-website-redesign</a></li><li><a href="0431-guides-restructure.html">0431-guides-restructure</a></li><li><a href="0432-contextual-helpers.html">0432-contextual-helpers</a></li><li><a href="0435-modifier-splattributes.html">0435-modifier-splattributes</a></li><li><a href="0440-decorator-support.html">0440-decorator-support</a></li><li><a href="0445-deprecate-with.html">0445-deprecate-with</a></li><li><a href="0446-contribution-guides.html">0446-contribution-guides</a></li><li><a href="0449-deprecate-partials.html">0449-deprecate-partials</a></li><li><a href="0451-injection-parameter-normalization.html">0451-injection-parameter-normalization</a></li><li><a href="0452-ember-data-medium-term-plan.html">0452-ember-data-medium-term-plan</a></li><li><a href="0457-nested-lookups.html">0457-nested-lookups</a></li><li><a href="0459-angle-bracket-built-in-components.html">0459-angle-bracket-built-in-components</a></li><li><a href="0460-yieldable-named-blocks.html">0460-yieldable-named-blocks</a></li><li><a href="0461-ember-data-singleton-record-data.html">0461-ember-data-singleton-record-data</a></li><li><a href="0463-record-data-state.html">0463-record-data-state</a></li><li><a href="0465-record-data-errors.html">0465-record-data-errors</a></li><li><a href="0466-request-state-service.html">0466-request-state-service</a></li><li><a href="0468-classic-decorator.html">0468-classic-decorator</a></li><li><a href="0470-fn-helper.html">0470-fn-helper</a></li><li><a href="0471-on-modifier.html">0471-on-modifier</a></li><li><a href="0477-blueprints-update.html">0477-blueprints-update</a></li><li><a href="0478-tracked-properties-updates.html">0478-tracked-properties-updates</a></li><li><a href="0481-component-templates-co-location.html">0481-component-templates-co-location</a></li><li><a href="0486-deprecate-mouseenter.html">0486-deprecate-mouseenter</a></li><li><a href="0487-custom-model-classes.html">0487-custom-model-classes</a></li><li><a href="0491-deprecate-disconnect-outlet.html">0491-deprecate-disconnect-outlet</a></li><li><a href="0494-async-observers.html">0494-async-observers</a></li><li><a href="0496-handlebars-strict-mode.html">0496-handlebars-strict-mode</a></li><li><a href="0507-embroider-v2-package-format.html">0507-embroider-v2-package-format</a></li><li><a href="0519-2019-2020-roadmap.html">0519-2019-2020-roadmap</a></li><li><a href="0521-find-by-identifier.html">0521-find-by-identifier</a></li><li><a href="0522-default-serializers-and-adapters.html">0522-default-serializers-and-adapters</a></li><li><a href="0523-model-argument-for-route-templates.html">0523-model-argument-for-route-templates</a></li><li><a href="0554-deprecate-getwithdefault.html">0554-deprecate-getwithdefault</a></li><li><a href="0558-edition-detection.html">0558-edition-detection</a></li><li><a href="0580-destroyables.html">0580-destroyables</a></li><li><a href="0581-new-test-waiters.html">0581-new-test-waiters</a></li><li><a href="0585-improved-ember-registry-apis.html">0585-improved-ember-registry-apis</a></li><li><a href="0615-autotracking-memoization.html">0615-autotracking-memoization</a></li><li><a href="0617-rfc-stages.html">0617-rfc-stages</a></li><li><a href="0625-helper-managers.html">0625-helper-managers</a></li><li><a href="0626-invoke-helper.html">0626-invoke-helper</a></li><li><a href="0628-prettier.html">0628-prettier</a></li><li><a href="0631-refresh-method-for-router-service.html">0631-refresh-method-for-router-service</a></li><li><a href="0635-ember-new-lang.html">0635-ember-new-lang</a></li><li><a href="0637-customizable-test-setups.html">0637-customizable-test-setups</a></li><li><a href="0638-interactive-app-creation.html">0638-interactive-app-creation</a></li><li><a href="0639-replace-blacklist-whitelist.html">0639-replace-blacklist-whitelist</a></li><li><a href="0645-add-ember-page-title-addon.html">0645-add-ember-page-title-addon</a></li><li><a href="0649-deprecation-staging.html" class="active">0649-deprecation-staging</a></li><li><a href="0659-unique-id-helper.html">0659-unique-id-helper</a></li><li><a href="0671-modernize-built-in-components-1.html">0671-modernize-built-in-components-1</a></li><li><a href="0673-deprecate-tryinvoke.html">0673-deprecate-tryinvoke</a></li><li><a href="0674-deprecate-transition-methods-of-controller-and-route.html">0674-deprecate-transition-methods-of-controller-and-route</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title"></h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <hr />
<p>Start Date: 2020-06-18
Relevant Team(s): Ember.js, Learning, Steering, Ember CLI
RFC PR: https://github.com/emberjs/rfcs/pull/649</p>
<hr />
<h1><a class="header" href="#deprecation-staging" id="deprecation-staging">Deprecation Staging</a></h1>
<h2><a class="header" href="#summary" id="summary">Summary</a></h2>
<p>Establish a staging system for deprecations that allows Ember and other
libraries to roll them out more incrementally. This system will also enable
users to opt-in to a more strict usage mode, where deprecations will assert if
encountered.</p>
<p>The initial stages would be:</p>
<ol>
<li>Available</li>
<li>Enabled</li>
</ol>
<h2><a class="header" href="#motivation" id="motivation">Motivation</a></h2>
<p>Ember has a robust deprecation system that has served the community well. However,
there are a number of pain points and use cases that it does not cover very well:</p>
<ul>
<li>
<p><strong>Ecosystem Absorption</strong>: Generally, deprecations need to be absorbed by the
addon ecosystem before they can be absorbed by applications. This is because
apps may see a deprecation that is triggered by addon code, that they have no
control over (other than jumping in and helping out the addon author by reporting
an issue or sending in a pull request). However, today there is no way to add a
deprecation just for
addons - adding a deprecation will make it appear everywhere at once.</p>
<p>This creates pressure to only add deprecations when most of the community has
already transitioned away from the API. However, it also means that we can't
send a strong signal, like a deprecation, to let the community know that it
<em>should</em> begin transitioning. This cyclic dependency can make it difficult to
push the community forward over time.</p>
<p>Deprecation staging would allow deprecations to be added incrementally.
Combined with default settings for apps and addons that enable deprecations at
different stage levels, this would allow incremental rollout throughout the
ecosystem.</p>
</li>
<li>
<p><strong>Pacing</strong>: Currently, deprecations must have their timeline built
directly into the deprecation RFC from the beginning. The deprecation API requires an <code>until</code> version,
and there isn't much flexibility during the rollout process because of this.
Once a deprecation is RFC'd and merged, there isn't much the community can do
to slow down the process.</p>
<p>Staging would give the community multiple checkpoints to decide
whether or not a deprecation was ready to move forward in the process, and to
update the timeline if so. This would allow a deprecation to slow down or
speed up based on real world feedback and absorption.</p>
</li>
<li>
<p><strong>Early Adoption</strong>: Since the current system discourages us from adding
deprecations until we are sure they are ready, it also prevents early adopters
from getting good signals about which patterns are on the way out. This
prevents them from exploring replacements, which means the ecosystem has even
less ability to adapt to deprecations and move forward.</p>
<p>Staging would allow us to introduce deprecations and allow early adopters to
explore them. This would allow us to determine if the new APIs that have been
introduced fully cover the use cases of the APIs that are being deprecated.</p>
</li>
<li>
<p><strong>Restricting Usage/Preventing Backsliding</strong>: Finally, many times deprecations
are fully removed from an Ember app or addon, only to accidentally be added
again in the future. Since deprecations only produce a console warning by default,
it is difficult and unintuitive to prevent this today.</p>
<p>With staging, users will be able to opt-in to deprecations becoming
assertions at a particular stage, in a non breaking way. This will allow users
to prevent backsliding as they incrementally migrate their applications to new
APIs. It will also provide the basis for future RFCs to explore compiling away deprecated features -
if they throw an error when used, they can't be used, so they can also be
removed and the app will continue to work.</p>
</li>
</ul>
<h2><a class="header" href="#detailed-design" id="detailed-design">Detailed design</a></h2>
<p>There are two stages that are proposed for deprecations in this RFC:</p>
<ol>
<li>
<p><strong>Available</strong>: Deprecations are initially released in the available stage.
Available deprecations are enabled by default in addons, but not in apps.
This is explained in more detail later.</p>
</li>
<li>
<p><strong>Enabled</strong>: Enabled is the final stage for deprecations. Deprecations
should be moved into Enabled after the replacement APIs have moved into
Recommended in the RFC process, and there is generally high confidence that
the addon ecosystem has absorbed the deprecation for the most part.
Enabled deprecations cannot be disabled.</p>
</li>
</ol>
<p>Deprecations will progress through these stages linearly. In the future, more
stages could be added, but the progression will remain linear. Deprecations that
involve an RFC (as most do), should lay out a plan for how and when a deprecations
will advance to the next stage, but <em>this</em> RFC does not try to prescribe that
progress.</p>
<p>There are two mechanisms that will need new behavior for the proposed staging
system:</p>
<ul>
<li>The <code>deprecate</code> function</li>
<li>The <code>ember</code> config on <code>package.json</code></li>
</ul>
<h3><a class="header" href="#deprecate" id="deprecate"><code>deprecate</code></a></h3>
<p>The current deprecation function receives the following options:</p>
<pre><code class="language-ts">interface DeprecationOptions {
  id: string;
  until: string;
  url?: string;
}
</code></pre>
<p>This will be updated to the following:</p>
<pre><code class="language-diff">interface DeprecationOptions {
  id: string;
  until: string;
  url?: string;
+ for: string;
+ since: {
+   available: string;
+   enabled: string;
+ }
}
</code></pre>
<p>Stepping through the new options individually:</p>
<ul>
<li>
<p><code>for</code>: This is used to indicate the library that the deprecation is for.
<code>deprecate</code> is a public API that can be used by anyone. Now that we intend to
show or hide deprecations based on their stage, we need to have some more
information about what library the deprecation belongs to. It should be the
package name for the library. This can be any string, but in the future, we may
be able to loosen this requirement by using a macro that can get the name of
the package that invokes <code>deprecate()</code>.</p>
</li>
<li>
<p><code>since</code>: This property contains a set of keys corresponding to
each deprecation stage. If a value for a stage if present, the value of all
previous stages must also be present. Each key's value is an exact SemVer
value. To start, only two keys (<code>available</code> and <code>enabled</code>) will
be allowed, and the rest will be ignored.</p>
<p>Any SemVer value can be used here, even if it does not correspond to a published
artifact in a package registry. This is for the sake of simplicity and flexibility,
but it should be noted that creating a deprecation that becomes available in the
future is not recommended.</p>
<p>The highest stage that has a value is considered the stage of the
deprecation is in. Any of the values may be used for deprecation compliance
assertions, depending on the app or addon configuration. This is explained
more below.</p>
</li>
</ul>
<p>If the <code>since</code> key is not provided (as is the case for existing deprecations),
the deprecation is assumed to be <code>enabled</code>. This RFC also... wait for it... deprecates
the usage of the <code>deprecate()</code> function without a <code>since</code> key. This meta deprecation
will be enabled at the same time as it becomes available like this:</p>
<pre><code class="language-js">
// 3.21.0 is fabricated here. It will be the next version that is released
// after this RFC is merged / when the work is done.
const NEXT_VERSION = '3.21.0';

deprecate('Calling deprecate() without the \'since\' key is deprecated', false, {
  id: 'ember-source.deprecate',
  until: '4.0.0',
  since: {
    available: NEXT_VERSION,
    enabled: NEXT_VERSION,
  }
})
</code></pre>
<h3><a class="header" href="#configuring-apps" id="configuring-apps">Configuring Apps</a></h3>
<p>Users can configure their application using the <code>ember.deprecations</code>
property in <code>package.json</code>. This property is empty by default, but can be
customized to indicate which versions of an addon the app is compliant with.
This configuration can be described like this:</p>
<pre><code class="language-ts">type DeprecationStage = 'available' | 'enabled';
type Editions = 'classic' | 'octane';

interface AddonDeprecationConfig {
  stage: DeprecationStage;
  version: StrictSemVerString;
  display?: DeprecationStage;
}

interface EmberPackageJSONKey {
  edition?: Editions;
  deprecations?: {
    display?: DeprecationStage;
    addons?: {
      [packageName: string]?: AddonDeprecationConfig;
    }
  }
}
</code></pre>
<p>The new <code>deprecations</code> key has two keys of its own:</p>
<ul>
<li>
<p><code>display</code>: which configures the default stage of deprecations the app owner
wants to see from their app and all addons. If this config is not provided, it defaults to <code>'enabled'</code>.</p>
</li>
<li>
<p><code>addons</code>: which declares which versions of each library the app is compliant with.</p>
<p>Each key points to an object conforming to the <code>AddonDeprecationConfig</code> interface.</p>
<p>Note that while deprecations can be created by applications themselves
(by calling <code>deprecate()</code> in app code), the top level key is still called <code>addons</code>.
The reasoning is that <em>most</em> of the time, Ember does not need to know about
deprecations from applications, as it needs no build-time signaling. These deprecations
will always be displayed and treated as if they are at the <code>enabled</code> stage. Because
there is no compliance config, they will not be promoted to runtime assertions.</p>
</li>
</ul>
<h3><a class="header" href="#addondeprecationconfig" id="addondeprecationconfig">AddonDeprecationConfig</a></h3>
<p>The keys in each <code>AddonDeprecationConfig</code> are:</p>
<ul>
<li><code>stage</code>: This declares compliance with the addon's deprecations to the stage given.</li>
<li><code>version</code>: This declares compliance with the addon's deprecations to the version given.</li>
<li><code>display</code>: This overrides the root level <code>display</code> config, to allow fine grain control over logged deprecations.</li>
</ul>
<p>The <code>stage</code> and <code>version</code> keys are explained in more detail below.</p>
<h3><a class="header" href="#deprecation-compliance" id="deprecation-compliance">Deprecation Compliance</a></h3>
<p>Users can opt-in to some deprecations becoming assertions. They do this by
stating that their application is <em>compliant</em> with a given library's
deprecations as of a certain stage and version.</p>
<p>This means that the app is guaranteeing that it does not use <em>any</em> deprecated
APIs that were in <em>the given stage</em> in <em>the given version</em>.
If they <em>do</em> use an API that was deprecated prior to version specified, the invocation of <code>deprecate</code> will
throw an error instead of logging a warning. The error will contain the same
message, with an additional note that the user is encountering this error
because of their deprecation compliance settings.</p>
<p>Deprecation compliance cannot be specified for a version of the
library newer than the one that is installed. Attempting to do this will throw an
error. This is to prevent developers from optimistically declaring compliance with
code that they are not yet running. This also prevents an edge case scenario where
compliance is declared with a version that has not been released yet and accidentally
opting into unknown deprecations when that version <em>does</em> get released.</p>
<h3><a class="header" href="#parsing-compliance-declarations" id="parsing-compliance-declarations">Parsing Compliance Declarations</a></h3>
<p>Apps can declare compliance with an addon in two ways:</p>
<ul>
<li>by omitting a declaration</li>
<li>by passing an object conforming to the <code>AddonDeprecationConfig</code> interface.</li>
</ul>
<p>If a declaration is omitted, Ember will assume that the app is compliant with
all deprecations in the &quot;enabled&quot; stage, but will not opt the app into any assertions.
This ensures backwards compatibility with apps that do not add this config.</p>
<p>If a <code>AddonDeprecationConfig</code> object is passed, Ember will assume that the app
is compliant with deprecations of the configured <code>stage</code> and later, and the
configured <code>version</code> and earlier. Deprecations that fit this configuration
will also throw assertions in development builds.</p>
<p>Note that <code>AddonDeprecationConfig</code> must have both the
<code>version</code> and the <code>stage</code> properties to be be valid. If both are not provided
a build time error will be thrown.</p>
<h3><a class="header" href="#usage-and-config-example" id="usage-and-config-example">Usage and Config Example</a></h3>
<p>Let's say that we use <code>deprecate()</code> to add a new deprecation to our library.
Because it's new, we're going to put it in the &quot;available&quot; stage.</p>
<pre><code class="language-js">deprecate('this feature is deprecated!', false, {
  id: 'my-awesome-library.my-awesome-feature',
  for: 'my-awesome-library',
  since: {
    available: '1.2.3'
  },
  until: '2.0.0'
});
</code></pre>
<p>There are a few common variations of compliance config:</p>
<ul>
<li>
<p>No config</p>
<pre><code class="language-json">{
  &quot;ember&quot;: {}
}
</code></pre>
<p>This means that an app may not be compliant with the deprecation from
<code>my-awesome-library</code>. Because Ember doesn't have an explicit declaration,
it will not promote the deprecation to an assertion, regardless of which
version of <code>my-awesome-library</code> is installed.</p>
</li>
<li>
<p>Later stage, current version</p>
<pre><code class="language-json">{
  &quot;ember&quot;: {
    &quot;deprecations&quot;: {
      &quot;addons&quot;: {
        &quot;my-awesome-library&quot;: {
          &quot;stage&quot;: &quot;enabled&quot;,
          &quot;version&quot;: &quot;1.2.3&quot;
        }
      }
    }
  }
}
</code></pre>
<p>This indicates that the app is not compliant with <code>my-awesome-feature</code>
deprecation, so Ember will not promote it to an assertion, regardless of which
version of <code>my-awesome-library</code> is installed.</p>
</li>
<li>
<p>Current stage, but older version.</p>
<pre><code class="language-json">{
  &quot;ember&quot;: {
    &quot;deprecations&quot;: {
      &quot;addons&quot;: {
        &quot;my-awesome-library&quot;: {
          &quot;stage&quot;: &quot;available&quot;,
          &quot;version&quot;: &quot;1.0.0&quot;
        }
      }
    }
  }
}
</code></pre>
<p>This config indicates that the app is not compliant with deprecations added
after 1.0.0, so Ember will not promote the <code>my-awesome-feature</code> deprecation to
an assertion.</p>
</li>
<li>
<p>Matching stage and version</p>
<pre><code class="language-json">{
  &quot;ember&quot;: {
    &quot;deprecations&quot;: {
      &quot;addons&quot;: {
        &quot;my-awesome-library&quot;: {
          &quot;stage&quot;: &quot;available&quot;,
          &quot;version&quot;: &quot;1.2.3&quot;
        }
      }
    }
  }
}
</code></pre>
<p>This indicates that the app <em>is</em> compliant with the <code>my-deprecation-feature</code> and
Ember will throw a runtime assertion if this deprecation is invoked.</p>
</li>
</ul>
<p>Now consider that <code>my-awesome-feature</code> becomes a enabled deprecation in 1.5.0:</p>
<pre><code class="language-diff">deprecate('this feature is deprecated!', false, {
  id: 'my-awesome-library.my-awesome-feature',
  for: 'my-awesome-library',
  since: {
    available: '1.2.3',
+   enabled: '1.5.0',
  },
  until: '2.0.0'
});
</code></pre>
<p>The configurations described above would be affected in the following ways:</p>
<ul>
<li>No config: no change</li>
<li>Later stage, current version: no change, because it was not enabled in 1.2.3</li>
<li>Current stage, older version: no change</li>
<li>Matching stage and version: no change</li>
</ul>
<p>In order to opt-in to an assertion for this enabled config, the app would have
to update their declaration to match the <code>since.enabled</code> value:</p>
<pre><code class="language-json">{
  &quot;ember&quot;: {
    &quot;deprecations&quot;: {
      &quot;addons&quot;: {
        &quot;my-awesome-library&quot;: {
          &quot;stage&quot;: &quot;enabled&quot;,
          &quot;version&quot;: &quot;1.5.0&quot;
        }
      }
    }
  }
}
</code></pre>
<h3><a class="header" href="#configuring-addons" id="configuring-addons">Configuring Addons</a></h3>
<p>Addons are also able to declare their compliance with other libraries in the same
way as above. A declaration from an addon tells Ember that its <em>parent</em> addon or application
cannot declare compliance to a higher version.</p>
<p>This allows <em>application</em> developers to feel confident that if they declare a
compliance with a <em>high</em> version, Ember's tooling will tell them early that they
have incompatible addons installed.</p>
<p>An addon can specify its deprecation config in the same way as an application,
but there are some notable differences:</p>
<h4><a class="header" href="#limited-to-ember-source" id="limited-to-ember-source">Limited to ember-source</a></h4>
<p>Addons are recommended to declare compliance <em>only</em> with the <code>ember-source</code> library.
This recommendation does not <em>prevent</em> this mechanism from being used with other libraries,
but the core team would like to exercise this feature before recommending good
patterns and behavior. A warning will be logged in development, if addons declare
compliance with libraries other than <code>ember-source</code>.</p>
<h4><a class="header" href="#declaration-and-defaults" id="declaration-and-defaults">Declaration and Defaults</a></h4>
<p>While applications must set a <code>StrictSemVerString</code> value for
<code>addons.[packageName].version</code>, addons can additionally set a special
value of <code>&quot;auto&quot;</code>, to indicate that the addon is compliant with
deprecations from the <em>minimum</em> version of the SemVer range specified by the
<code>dependencies</code> or <code>devDependencies</code> in its <code>package.json</code>. The configured stage
would still be used as that stage of declared compliance.</p>
<p>The benefit of these new semantics is that the majority of addon authors don't
have to declare that they are compliant and runtime assertions are not introduced
to apps without any major version updates.</p>
<p>Additionally, this <code>auto</code> keyword would allow addon authors to use automation
(e.g Dependabot) to update their package's dependencies and get valuable CI
feedback about their addon violating new deprecations, without having to update
any compliance config.</p>
<h4><a class="header" href="#example" id="example">Example</a></h4>
<p>Let's look at a complete example with a real world scenario. In 3.15.0,
Ember deprecated <a href="https://github.com/emberjs/ember.js/blob/master/CHANGELOG.md#v3150-december-9-2019">use of the <code>isVisible</code> property</a> in components. Although
Deprecation Stages did not exist at the time, this is how that deprecation would
be created after this RFC:</p>
<pre><code class="language-js">deprecate('\`isVisble\` is deprecated!', false, {
  id: 'ember-component.is-visible',
  for: 'ember-source', // new property
  until: '4.0.0',
  since: {
    available: '3.15.0',
    enabled: '3.16.0', // this is fabricated for this example
  }
});
</code></pre>
<p>This means that the deprecation for the <code>isVisible</code> property became <em>available</em>
in 3.15, but became enabled in 3.16.</p>
<p>Now let's consider an addon that has a component that uses <code>isVisible</code>, but
doesn't declare any deprecation compliance. In other words, it does not make
any changes or release any new versions. Its <code>package.json</code> config looks like this:</p>
<pre><code class="language-json">{
  &quot;devDependencies&quot;: {
    &quot;ember-source&quot;: &quot;~3.16.0&quot;
  },
  &quot;ember&quot;: {}
}
</code></pre>
<p>Because no compliance is declared, Ember will not make any assumptions about
this addon's compliance. On the other hand, Ember will also not actively
<em>prevent</em> an app from declaring its own compliance. This not only lets apps
use this feature without updating every addon in the ecosystem, it also provides
incentive for the community to add compliance declarations into every addon, so
that they can provide valuable signals to apps and Ember.</p>
<p><strong>TODO</strong>: if the app declares it's compliant with available+3.15 deprecations,
and uses this addon, should Ember promote the deprecation to a runtime assertion?
Pro: apps know immediately that they are not actually compliant when they thought
they were. Con: the only way to &quot;unbreak&quot; an app is to update the addon or to lower
their own compliance config -- both are manual steps.</p>
<p>Next, let's consider that the addon declares its compliance using the <code>auto</code> keyword instead.
(All new addons will have this config from the addon blueprint, so this will be the
next most common scenario.)</p>
<pre><code class="language-json">{
  &quot;devDependencies&quot;: {
    &quot;ember-source&quot;: &quot;~3.16.0&quot;
  },
  &quot;ember&quot;: {
    &quot;deprecations&quot;: {
      &quot;addons&quot;: {
        &quot;ember-source&quot;: {
          &quot;stage&quot;: &quot;available&quot;,
          &quot;version&quot;: &quot;auto&quot;
        }
      }
    }
  }
}
</code></pre>
<p>Here, the addon is actively declaring that it is compliant with all available
deprecations in <code>ember-source</code> 3.16.0, but not in 3.16.1 and beyond. Because this is an active
declaration, Ember will use it for two things:</p>
<ol>
<li>It will not allow parent addons/apps to declare compliance above 3.16.0.</li>
<li>It will promote usage of <code>isVisible</code> (and other deprecations that fit the same criteria)
to a runtime assertion, assuming that these usages are unexpected.</li>
</ol>
<p>If the addon were to change its devDependencies to <code>~3.17.0</code>, <em>more</em> deprecations
would fall into this category, without the addon author needing to update anything
else. In this way, the <code>&quot;auto&quot;</code> configuration allows addon authors to give parent
apps the best scenario, without having to micromanage another config.</p>
<p>Lastly, the addon can explicitly state that it does <em>not</em> comply with the <code>isVisible</code>
deprecation by setting their compliance to a SemVer version (similar to how an
application would declare the same):</p>
<pre><code class="language-json">{
  &quot;devDependencies&quot;: {
    &quot;ember-source&quot;: &quot;~3.16.0&quot;
  },
  &quot;ember&quot;: {
    &quot;deprecations&quot;: {
      &quot;addons&quot;: {
        &quot;ember-source&quot;: {
          &quot;stage&quot;: &quot;enabled&quot;,
          &quot;version&quot;: &quot;3.14.3&quot;
        }
      }
    }
  }
}
</code></pre>
<p>In this config, the <code>ember-source</code> version installed in <code>devDependencies</code> is
irrelevant and is ignored.</p>
<p>This config tells Ember that parent apps <em>cannot</em> declare themselves to be in
compliance with even <em>available</em> deprecations in 3.15.0, because they install
a dependency that is not compliant. Ember will throw a build time error for
parent apps that attempt to do this. For example, this config will throw an error:</p>
<pre><code class="language-json">{
  &quot;ember-source&quot;: {
    &quot;stage&quot;: &quot;available&quot;,
    &quot;version&quot;: &quot;3.15.0&quot;
  }
}
</code></pre>
<p>This means that apps that use dependencies that have pinned their compliance to
an older version, must either contribute to the dependency or fork it.</p>
<p>There are some rare cases in which a addon declares its compliance to a version
due to a deprecation it cannot address, but that part of the addon is not used
by the parent app. This RFC does <em>not</em> attempt to solve this use case as deprecation
compliance is namespaced by the name of the package, rather than individual features.</p>
<h3><a class="header" href="#new-apps-and-addons" id="new-apps-and-addons">New apps and addons</a></h3>
<p>App blueprints will be updated to include the following config:</p>
<pre><code class="language-json">{
  &quot;ember&quot;: {
    &quot;deprecations&quot;: {
      &quot;addons&quot;: {
        &quot;ember-source&quot;: {
          &quot;stage&quot;: &quot;enabled&quot;,
          &quot;version&quot;: &quot;&lt;%= version %&gt;&quot;
        }
      }
    }
  }
}
</code></pre>
<p>Addon blueprints will be updated opt addons into all <code>available</code> deprecations
with this config:</p>
<pre><code class="language-json">{
  &quot;ember&quot;: {
    &quot;deprecations&quot;: {
      &quot;addons&quot;: {
        &quot;ember-source&quot;: {
          &quot;stage&quot;: &quot;available&quot;,
          &quot;version&quot;: &quot;auto&quot;
        }
      }
    }
  }
}
</code></pre>
<h3><a class="header" href="#existing-method-of-handling-deprecations" id="existing-method-of-handling-deprecations">Existing Method of handling deprecations</a></h3>
<p>Today, apps have three mechanisms for handling deprecations:</p>
<ol>
<li><code>registerDeprecationHandler()</code>: which allows apps a custom way to handle deprecations</li>
<li><code>Ember.ENV.RAISE_ON_DEPRECATION</code> configuration, which promotes deprecations to assertions</li>
<li><code>ember-cli-deprecation-workflow</code> which makes it easier to work on one deprecation at a time</li>
</ol>
<p>This RFC treats these as out of scope, but also should not affect how they work.
Future RFCs may address them individually.</p>
<h2><a class="header" href="#how-we-teach-this" id="how-we-teach-this">How we teach this</a></h2>
<p>Advancing a deprecation through stages is conceptually easy to understand.
Application and addon developers who have no knowledge of this RFC should be
able to read a deprecation message and understand both that &quot;available&quot; deprecations
are not urgent and &quot;enabled&quot; deprecations require an action. This should be
reflected in the deprecation message that is logged.</p>
<p>New applications will have a much easier time understanding this as blueprints
will be updated to include some default configurations.</p>
<p>There will need to be new Guides for existing apps to be able to understand
new deprecations more easily. The deprecation message should log links to these
guides.</p>
<p>Some places in the guides that will have to be updated:</p>
<ul>
<li>https://cli.emberjs.com/release/writing-addons/deprecations/</li>
<li>https://guides.emberjs.com/release/configuring-ember/handling-deprecations/</li>
<li>https://guides.emberjs.com/release/configuring-ember/debugging/#toc_dealing-with-deprecations</li>
</ul>
<h2><a class="header" href="#drawbacks" id="drawbacks">Drawbacks</a></h2>
<ul>
<li>Confusion about what the config means.</li>
</ul>
<h2><a class="header" href="#alternatives" id="alternatives">Alternatives</a></h2>
<p>Not sure.</p>
<h2><a class="header" href="#unresolved-questions" id="unresolved-questions">Unresolved questions</a></h2>
<ul>
<li>How does addon config interact with the dummy app, since there is only one package.json?</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="0645-add-ember-page-title-addon.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="0659-unique-id-helper.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="0645-add-ember-page-title-addon.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="0659-unique-id-helper.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
